#!/usr/bin/env node
/**
 * Bundle skills from sibling packages into CLI
 * Run before building: node scripts/bundle-skills.js
 */

const fs = require('fs');
const path = require('path');

const PACKAGES_DIR = path.join(__dirname, '..', '..'); // packages/
const CLI_SRC = path.join(__dirname, '..', 'src');
const SDK_SKILLS = path.join(PACKAGES_DIR, 'star-sdk', 'skills', 'star-sdk');

function escapeTemplate(str) {
  return str
    .replace(/\\/g, '\\\\')
    .replace(/`/g, '\\`')
    .replace(/\$\{/g, '\\${');
}

function readFile(filepath) {
  try {
    return fs.readFileSync(filepath, 'utf-8');
  } catch (err) {
    console.error(`Warning: Could not read ${filepath}`);
    return '';
  }
}

// Read SKILL.md from star-sdk/skills/star-sdk/
const skillContent = readFile(path.join(SDK_SKILLS, 'SKILL.md'));

// Read PROMPT.md from each package
const audioDocs = readFile(path.join(PACKAGES_DIR, 'star-audio', 'PROMPT.md'));
const canvasDocs = readFile(path.join(PACKAGES_DIR, 'star-canvas', 'PROMPT.md'));
const leaderboardDocs = readFile(path.join(PACKAGES_DIR, 'star-leaderboard', 'PROMPT.md'));
// Generate TypeScript file
const output = `// AUTO-GENERATED - DO NOT EDIT
// Generated by scripts/bundle-skills.js

export const SKILL_CONTENT = \`${escapeTemplate(skillContent)}\`;

export const AUDIO_DOCS = \`${escapeTemplate(audioDocs)}\`;

export const CANVAS_DOCS = \`${escapeTemplate(canvasDocs)}\`;

export const LEADERBOARD_DOCS = \`${escapeTemplate(leaderboardDocs)}\`;
`;

fs.writeFileSync(path.join(CLI_SRC, 'skills.ts'), output);
console.log('Generated src/skills.ts');
